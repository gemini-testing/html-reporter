# Команды плагина

## Обзор

Плагин `html-reporter` добавляет к гермионе следующие команды:
* [gui](#gui) &mdash; чтобы запускать гермиону в GUI-режиме;
* [remove-unused-screens](#remove-unused-screens) &mdash; чтобы удалять неиспользуемые в тестах эталонные скриншоты;
* [merge-reports](#merge-reports) &mdash; чтобы объединять отдельные отчеты гермионы в один общий отчет.

## gui

Используйте команду `gui`, чтобы запустить гермиону в GUI-режиме.

GUI-режим позволяет:
* интерактивно запускать тесты;
* обновлять скриншоты &mdash; визуально отсматривая их и принимая только нужные диффы;
* переиспользовать отчеты из CI;
* фильтровать результаты прогона по ошибкам, ключам из меты, и пр.

### Использование

```bash
npx hermione gui
```

## remove-unused-screens

Используйте команду `remove-unused-screens`, чтобы удалить неиспользуемые в тестах эталонные скриншоты.

### Как это работает?

Сначала команда ищет скриншоты, для которых на файловой системе нет тестов.

Далее команда ищет скриншоты, которые не были использованы в успешном тестировании (результат тестов берется из базы данных SQLite). Для этого html-отчет должен существовать на файловой системе и содержать результаты прогона тестов. Это означает, что вы должны до запуска команды `remove-unused-screens` запустить тесты локально или загрузить отчет из CI.

### Использование

Команда `remove-unused-screens` поддерживает несколько опций:

| **Опция** | **Описание** |
| --------- | ------------ |
| -p, --pattern <pattern> | Шаблон для поиска скриншотов на файловой системе. |
| --skip-questions | Не задавать вопросов во время выполнения (использовать значения по умолчанию). |
| -h, --help | Вывести справочную информацию по команде в терминал. |

#### Примеры использования

Указываем папку, в которой надо искать неиспользуемые скриншоты:

```bash
npx hermione remove-unused-screens -p 'hermione-screens-folder'
```

Задаем маску, по которой будем искать скриншоты:

```bash
npx hermione remove-unused-screens -p 'screens/**/*.png'
```

Задаем несколько масок для поиска скриншотов:

```bash
npx hermione remove-unused-screens -p 'screens/**/chrome/*.png' -p 'screens/**/firefox/*.png'
```

Задаем папку для поиска скриншотов и просим не задавать вопросов:

```bash
npx hermione remove-unused-screens -p 'hermione-screens-folder' --skip-questions
```

Выводим справочную информацию о команде:

```bash
npx hermione remove-unused-screens --help
```

## merge-reports

Используйте команду `merge-reports`, чтобы объединить отдельные отчеты гермионы в один общий отчет.

Команда принимает пути к файлам баз данных или к файлам `databaseUrls.json` из других html-отчетов. Она создает новый html-отчет в папке назначения с общим файлом `databaseUrls.json`, который будет содержать ссылку на файл базы данных или на файлы `databaseUrls.json` из входных параметров. Файлы баз данных в папку назначения не копируются при этом.

### Использование

Команда `merge-reports` поддерживает следующие опции:

| **Опция** | **Описание** |
| --------- | ------------ |
| -d, --destination <folder> | Путь к папке, в которую нужно сохранить итоговый отчет. |
| -h, --header <header> | Http-хедер для загрузки databaseUrls.json из переданных исходных отчетов. |

Пример использования:

```bash
npx hermione merge-reports path-to-database.db path-to-databaseUrls.json -d dest-report -h foo=bar
```

Http-хедеры можно так же передавать с помощью переменной окружения - `html_reporter_headers` (имеет приоритет выше, чем cli-опция `--header`). Пример:

```bash
html_reporter_headers='{"foo":"bar"}' npx hermione merge-reports path-to-database.db path-to-databaseUrls.json -d dest-report -h baz=qux
```

В итоге `path-to-databaseUrls.json` будет запрошен с хедерами: `{foo: 'bar', baz: 'qux'}`.
